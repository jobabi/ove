# `@ove-lib/filter`

> Library for [Open Visualization Environment (OVE)](https://github.com/ove/ove) framework that provides functions to filter arrays of data.

This allows all OVE applications to filter data (or to interpret a specification for highlighting) in a consistent way.

It exposes two methods: one accepts a query as a string, and parses this into a syntax tree; the second accepts this tree and returns a predicate function that evaluates whether an object matches the query.
The intermediate syntax tree has a structure similar to that produced by [odata-parser](https://www.npmjs.com/package/odata-v4-parser).


## Query language

The query language corresponds to a a subset of [OData Filter System Query Option](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/) version 2.0; the type functions, such as `isOf` are not implemented.

Functions and operators added to later versions of ODate (such as collection functions, geo functions, and lambda operators) are not implemented.

Dates are assumed to be either JavaScript [`Date`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date) objects, or strings in the format recognised by [`Date.parse()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/parse).
Alternatively, the `getPredicate()` function can be provided with a function that will convert strings to JavaScript Date objects; this function could, for example, be generated by [`d3.timeParse`](https://github.com/d3/d3-time-format).

## Usage

### As a node package

This module can be installed with npm:

```bash
npm install @ove-lib/filter --save
```

It can then be included with `require`:

```javascript

const getPredicate = require('@ove-lib/filter/filter').getPredicate;
const parse = require('@ove-lib/filter/parser').parse;

const queryString = parse('age gt 21');
const predicate = getPredicate(queryString);

let people = [{name: 'Bob', age: 25}, {name: 'Sam', age: 18}];

predicate({name: 'Bob', age: 25}); // True
predicate({name: 'Sam', age: 18}); // False

// Can use with Array.prototype.filter()
people.filter(predicate); // [{name: 'Bob', age: 25}]
```


### On the front-end, in a browser

To use the filtering functions within a web browser, first include the single file `dist/filter.all.min.js`, and then use the methods `Filter.parse()` and `Filter.getPredicate()`:

```HTML

<script = 'path/to/filter.all.min.js />'

<script>
const queryString = Filter.parse('age gt 21');
const predicate = Filter.getPredicate(queryString);

let people = [{name: 'Bob', age: 25}, {name: 'Sam', age: 18}];

predicate({name: 'Bob', age: 25}); // True
predicate({name: 'Sam', age: 18}); // False

// Can use with Array.prototype.filter()
people.filter(predicate); // [{name: 'Bob', age: 25}]

</script>

```
